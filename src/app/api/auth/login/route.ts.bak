import { NextResponse } from "next/server";

import { createAuthCookie, isAuthConfigured, verifyAdminCredentials } from "@/lib/auth";

export async function POST(req: Request) {
  // ADD THESE LOGS:
  console.log("Login Attempt Detected");
  console.log("Env Email:", process.env.ADMIN_EMAIL); 
  console.log("Env Password:", process.env.ADMIN_PASSWORD); 

export async function POST(req: Request) {
  if (!isAuthConfigured()) {
    return NextResponse.json(
      { error: "Admin auth is not configured on this server." },
      { status: 500 },
    );
  }

  const body = (await req.json().catch(() => ({}))) as Partial<{
    email: string;
    password: string;
  }>;

  const email = (body.email ?? "").trim();
  const password = body.password ?? "";

  if (!email || !password) {
    return NextResponse.json({ error: "Missing email or password." }, { status: 400 });
  }

  if (!verifyAdminCredentials(email, password)) {
    return NextResponse.json({ error: "Invalid credentials." }, { status: 401 });
  }

  const res = NextResponse.json({ ok: true });
  res.headers.append("Set-Cookie", createAuthCookie());
  return res;
}